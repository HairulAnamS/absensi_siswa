<h3>Data Kelas</h3>

<% if (typeof error !=='undefined' ) { %>
  <div style="color: red; margin-bottom: 10px;">
    <%= error %>
  </div>
  <% } %>

    <form id="formKelas" action="/kelas/tambah" method="POST">
      <input type="hidden" name="id" id="kelasId">
      <input type="text" name="kode" id="kode" placeholder="Kode" required>
      <input type="text" name="nama" id="nama" placeholder="Nama Kelas" required>
      <button type="submit" id="submitBtn">Tambah</button>
      <button class="btnCancel" type="button" id="cancelBtn" style="display:none;">Batal</button>
    </form>

    <!-- Tombol Toggle Filter -->
    <button type="button" onclick="toggleFilter()" style="margin-top: 10px;">Tampilkan/Sembunyikan Filter</button>

    <!-- Form Filter -->
    <form id="formFilter" action="/kelas" method="GET"style="<%= typeof filter !== 'undefined' && filter !== '' ? 'display:block;' : 'display:none;' %>; margin-top: 10px;">
      <label>Cari Data :</label>
      <!-- <select name="kolom">
        <option value="nama" <%=filterKolom==='nama' ? 'selected' : '' %>>Nama</option>
        <option value="kode" <%=filterKolom==='kode' ? 'selected' : '' %>>Kode</option>
      </select> -->
      <input type="text" name="cari" placeholder="Masukkan kata kunci..."
        value="<%= typeof filter !== 'undefined' ? filter : '' %>">
      <button type="submit">Filter</button>
    </form>

    <table>
      <thead>
        <tr>
          <th style="width: 140px;">Aksi</th>
          <th>Kode</th>
          <th>Nama</th>
        </tr>
      </thead>
      <tbody>
        <% kelas.forEach(k=> { %>
          <tr>
            <td>
              <button type="button" class="btnEdit" data-id="<%= k.id %>" data-kode="<%= k.kode %>"
                data-nama="<%= k.nama %>">
                Edit
              </button>


              <form action="/kelas/hapus/<%= k.id %>" method="POST" style="display:inline">
                <button class="btnHapus" onclick="return confirm('Hapus data?')">Hapus</button>
              </form>
            </td>
            <td>
              <%= k.kode %>
            </td>
            <td>
              <%= k.nama %>
            </td>
          </tr>
          <% }) %>
      </tbody>
    </table>
    <br></br>

    <script>
      const form = document.getElementById('formKelas');
      const submitBtn = document.getElementById('submitBtn');
      const cancelBtn = document.getElementById('cancelBtn');
      const inputKode = document.getElementById('kode');

      document.querySelectorAll('.btnEdit').forEach(btn => {
        btn.addEventListener('click', function () {
          const id = this.dataset.id;
          const kode = this.dataset.kode;
          const nama = this.dataset.nama;

          // Isi form
          document.getElementById('kelasId').value = id;
          document.getElementById('kode').value = kode;
          document.getElementById('nama').value = nama;

          // Ubah action form & label tombol
          form.action = `/kelas/edit/${id}`;
          submitBtn.textContent = 'Update';
          cancelBtn.style.display = 'inline'; // tampilkan tombol batal

          // Buat input kode readonly
          inputKode.readOnly = true;
        });
      });

      // Fungsi tombol batal
      cancelBtn.addEventListener('click', function () {
        // Reset nilai input
        document.getElementById('kelasId').value = '';
        document.getElementById('kode').value = '';
        document.getElementById('nama').value = '';

        // Kembalikan form ke mode tambah
        form.action = '/kelas/tambah';
        submitBtn.textContent = 'Tambah';
        cancelBtn.style.display = 'none';

        // Kembalikan input kode bisa diisi
        inputKode.readOnly = false;
      });

      function toggleFilter() {
        const form = document.getElementById('formFilter');
        form.style.display = form.style.display === 'none' ? 'block' : 'none';
      }
    </script>